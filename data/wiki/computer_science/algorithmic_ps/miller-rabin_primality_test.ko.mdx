---
title: 밀러-라빈 소수 판별법
---

한 양의 정수 $n$이 소수임을 판별하는 방법으로 대표적으로 "에라토스테네스의 체"가 있다. 이는 $O(\sqrt{n})$의 시간 복잡도를 갖는다. 너무 느리다. 좀 더 빠른 방법이 없을까?

밀러-라빈 소수 판정법은 비결정적으로 소수를 판정하는 알고리즘이다. 그러나 `long long` 범위 내에서는 결정적으로 판정할 수 있어, 비로소 CP에 사용할 수 있게 된다. 우선 페르마 소수 판별법에 대해 알아보자.

# 페르마 소수 판별법

페르마의 소정리를 이용하여 소수를 판별하는 것이다. 페르마의 소정리에 대해 알아보자.

<Theorem title="정리" subtitle="페르마의 소정리">
    $p$가 소수이고, $a$가 $p$와 서로소인 정수라면, $a^{p-1} \equiv 1 \pmod{p}$이다.
</Theorem>

페르마의 소정리에 대한 증명은 여럿 있지만, 그 중 완전한 잉여류 집합을 활용한 증명을 소개하겠다.

<Theorem title="증명">
    $p$가 소수이고 $a$가 $p$와 서로소인 정수라고 하자. 다음과 같은 곱셈군을 생각해보자.

    $$
    S = \{a, 2a, 3a, \cdots, (p-1)a\}
    $$

    각 원소를 모듈로 $p$로 보면, $S$의 각 원소는 $\{1, 2, \cdots, p-1\}$의 어떤 순열이다. 즉, 서로 다른 값이며, $p$로 나눈 나머지가 1부터 $p-1$까지의 모든 수를 포함한다.

    이제 $S$의 모든 원소를 곱하면 다음과 같다.

    $$
    a \cdot 2a \cdot 3a \cdots (p-1)a
    $$

    왼쪽에서 $(p-1)!$을 인수로 묶을 수 있으므로,

    $$
    a^{p-1} (p-1)! \equiv (p-1)! \pmod{p}
    $$

    이다. 양변에서 $(p-1)!$은 $p$와 서로소이므로 약분할 수 있다.

    $$
    a^{p-1} \equiv 1 \pmod{p}
    $$

    따라서, 페르마의 소정리가 성립한다. $\blacksquare$
</Theorem>

$2 \leq a \leq p-2$ 범위의 정수 $a$를 선택해서 $p$의 소수성 판별에 사용할 수 있을 것이다. 하지만, 치명적인 문제가 있다. $a^{p-1} \not\equiv 1\pmod{p}$이면 $p$가 소수가 아님을 알 수 있지만, 페르마의 소정리를 만족한다고 해서 소수라고 단정할 수 없다. 따라서, 어떤 정수 $a$에 대해 $a^{p-1} \equiv 1 \pmod{p}$를 만족하는 정수 $p$를 _유사소수_<sub>pseudoprime</sub>라고 한다. 그렇다면 가능한 모든 $a$에 대해 만족하는지 확인해보면 되지 않을까? 아쉽게도 모든 정수 $a$에 대해 페르마의 소정리를 만족하지만 소수가 아닌 $p$가 있다. 이를 _카마이클 수_<sub>Carmichael number</sub>라고 한다.

# 밀러-라빈 소수 판별법

밀러-라빈 소수 판별법은 페르마 판별법을 확장한 것이다.

홀수 $n$에 대해 $n-1$은 짝수이므로, 2의 거듭제곱으로 묶을 수 있다. 따라서, 다음과 같이 적을 수 있다.

$$
n-1=2^s\cdot d\quad(d\text{는 홀수})
$$

이는 페르마의 소정리의 합동식을 인수분해할 수 있도록 한다.

$$
\begin{array}{rl}
a^{n-1} \equiv 1 \pmod n &\Longleftrightarrow a^{2^s d} - 1 \equiv 0 \pmod n \\
&\Longleftrightarrow (a^{2^{s-1} d} + 1) (a^{2^{s-1} d} - 1) \equiv 0 \pmod n \\
&\Longleftrightarrow (a^{2^{s-1} d} + 1) (a^{2^{s-2} d} + 1) (a^{2^{s-2} d} - 1) \equiv 0 \pmod n \\
&\quad\vdots \\
&\Longleftrightarrow (a^{2^{s-1} d} + 1) (a^{2^{s-2} d} + 1) \cdots (a^{d} + 1) (a^{d} - 1) \equiv 0 \pmod n \\
\end{array}
$$

$n$이 소수라면 위 인수 중 하나가 $n$으로 나누어떨어져야 할 것이다. 밀러-라빈 판별법은 바로 이 점을 검증하는 것이며, 따라서 페르마 판별법보다 더 엄밀하다. $2\leq a \leq n-2$인 밑 $a$에 대해

$$
a^d \equiv 1 \pmod{n}
$$

이나 $0\leq r \leq s-1$인 $r$에 대해

$$
a^{2^r d} \equiv -1 \pmod{n}
$$

가 성립하는 지를 확인한다.

위 합동식 중 하나라도 만족하지 않는 밑 $a$를 찾았다면 이는 $n$가 합성수라는 증거이다. 이 경우, $n$이 소수가 아니라는 것을 밝힌 셈이다.
